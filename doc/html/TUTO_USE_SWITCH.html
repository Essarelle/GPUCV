<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GpuCV: Using the auto-switch mechanisms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="twiki_style.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="TUTO_USE_SWITCH">Using the auto-switch mechanisms </a></h1><h2><a class="anchor" id="TUTO_USE_SWITCH__SCT_INTRO">
Intro</a></h2>
<dl class="user"><dt><b>PRE-REQUIS</b></dt><dd><ul>
<li>
none </li>
</ul>
</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd></dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Yannick Allusse </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>GpuCV v1.0.0 rev 580 </dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Turorial tag: <b>TUTO_USE_SWITCH_TAG</b></dd></dl>
<p><br/>
In this tutorial, we will describe how to use the switch mechanism into an existing application. <br/>
<br/>
Follow the key tag <b>TUTO_USE_SWITCH_TAG*</b> in full project source code to have the correspondance of each steps: </p>
<ol>
<li>
<a class="el" href="TUTO_USE_SWITCH.html#TUTO_USE_SWITCH__STP1__PRESENTAION">Global idea</a> </li>
<li>
<a class="el" href="TUTO_USE_SWITCH.html#TUTO_USE_SWITCH__STP2__INTEGRATION">Integrate the switch mechanism into an existing application</a> </li>
<li>
<a class="el" href="TUTO_USE_SWITCH.html#TUTO_USE_SWITCH__STP3__CUSTOMIZATION">Customize the switch mechanism</a> </li>
<li>
<a class="el" href="TUTO_USE_SWITCH.html#TUTO_USE_SWITCH__STP4__BENCHMARKS">Get performances feedbacks</a>  </li>
</ol>
<dl class="user"><dt><b>Files to edit</b></dt><dd>First, open/create the corresponding file: <ul>
<li>
your main source files and project files </li>
</ul>
</dd></dl>
<h2><a class="anchor" id="TUTO_USE_SWITCH__STP1__PRESENTAION">
Global idea</a></h2>
<p>The switch mecanism introduced into GpuCV can be quite handy, but also quite complex to anderstand and manipulate correclty. So let starts from scratch.</p>
<h3><a class="anchor" id="TUTO_USE_SWITCH__STP1__SUB1_WHAT">
What is it?</a></h3>
<p>The switch mecanism acts as a function multiplexer, from one input function call it will select and execute another function among several depending on the context or the input parameters. Here is an example: <br/>
Algorithm ALGO-A is supposed to process a set of data, FctA-1 and FctA-2 are two different implementations of this algorithm, they differ from some code optimisations or hardware support. <br/>
Without a switch, the code would look like: </p>
<div class="fragment"><pre class="fragment"><span class="comment">//performing ALGO-A</span>
<span class="keywordflow">if</span>(OPTION_XX)
        FctA-1(..);
<span class="keywordflow">else</span>
        FctA-2(..);
</pre></div><p> Here goes some questions of interrest: </p>
<ul>
<li>
What if I call ALGO-A hundreds times in my source code? </li>
<li>
What if I have a new implementation FctA-3 available? </li>
<li>
What if I FctA-2 is not supported by any developper and does not work any more, crashs or return wrong results? </li>
<li>
How to find the best implementation to call? </li>
</ul>
<p>GpuCV supply a complex switch mecanism design to offer easy solution for developers to all this anoying questions. Here is what your new code might look like: </p>
<div class="fragment"><pre class="fragment"><span class="comment">//performing process FctA threw a switch operator</span>
        FctA-Switch(..);
</pre></div><p> Now, what about theses anoying questions:</p>
<dl class="user"><dt><b>What if I call ALGO-A hundreds times in my source code?</b></dt><dd>I can be really easy to redirect function FctA to FctA-Switch, in fact one line is required in the corresponding header file: <div class="fragment"><pre class="fragment">...
#define FctA Fct-Switch
...
</pre></div> -&gt; No painful code update... <br/>
</dd></dl>
<dl class="user"><dt><b>What if I have a new implementation FctA-3 available?</b></dt><dd>The switch mecanism supplies a plugin system to allow as many implementations has required. You just need to provide the DLLs and some meta-data to help the switch to operate correclty. <br/>
</dd></dl>
<dl class="user"><dt><b>What if I FctA-2 is not supported by any developper and does not work any more, crashs or return wrong results?</b></dt><dd>The switch mecanism can enable/disable plugins or some functions using an external XML file, so no need to edit your code to control the plugin behavior. In some advanced usage, such as 'non regression testing', you can tell the switch that a given function is not working properly with corresponding set of input parameters so it will not be called again. <br/>
</dd></dl>
<dl class="user"><dt><b>How to find the best implementation to call?</b></dt><dd>The current switch mecanism choose the best implementation to call depending on these parameters: <ul>
<li>
Implementations available </li>
<li>
Hardware compatibility </li>
<li>
Depending on input parameters: <ul>
<li>
Implementation performances </li>
<li>
Implementation compatibility with input parameters </li>
<li>
Implementation correct processing </li>
<li>
Possible data tranfer required </li>
</ul>
</li>
</ul>
<br/>
</dd></dl>
<h3><a class="anchor" id="TUTO_USE_SWITCH__STP1__SUB2_WHY">
Why do we need to switch between operators?</a></h3>
<p>Some domains such as GPGPU offers many possibilities to implement a task that will behave differently based on: </p>
<ul>
<li>
Technology used: OpenGL + Shaders, CUDA, OpenCL... </li>
<li>
Host hardware performances: CPU and GPU family, speed, memory... </li>
<li>
Implementation quality and performances </li>
<li>
Input data properties: size, type, location in RAM or VRAM... </li>
</ul>
<p>There are two many parameters and they are varying from years to years so it is not possible to develop an application that will try to handle everythning manually. We need a easy-to-use mecanism to manage this complex task for us.</p>
<h2><a class="anchor" id="TUTO_USE_SWITCH__STP2__INTEGRATION">
Integrate the switch mechanism into an existing application</a></h2>
<p><em>Tag:</em> <b>TUTO_USE_SWITCH_TAG__STP1__INTEGRATION</b><br/>
</p>
<dl class="user"><dt><b>headers and libs...</b></dt><dd></dd></dl>
<dl class="user"><dt><b>source code update (what to avoid)</b></dt><dd></dd></dl>
<h2><a class="anchor" id="TUTO_USE_SWITCH__STP3__CUSTOMIZATION">
Customize the switch mechanism</a></h2>
<p><em>Tag:</em> <b>TUTO_USE_SWITCH_TAG__STP2__CUSTOMIZATION</b><br/>
</p>
<h2><a class="anchor" id="TUTO_USE_SWITCH__STP4__BENCHMARKS">
Get performances feedbacks</a></h2>
<p><em>Tag:</em> <b>TUTO_USE_SWITCH_TAG__STP3__BENCHMARKS</b><br/>
 </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1">
<table border="0" width="100%">
<tr>
<td>
Retrieve latest informations, releases and documentation on <a href="https://picoforge.int-evry.fr/cgi-bin/twiki/view/Gpucv/Web/WebHome">GpuCV website</a>.
</td>
<td width ="50">
</td>
<td>
<address style="text-align: right;"><small>Generated
on Wed Oct 22 20:37:13 2008 for <a href="https://picoforge.int-evry.fr/cgi-bin/twiki/view/Gpucv/Web/WebHome">GpuCV</a> by&nbsp;
<a href="http://www.doxygen.org/index.html"><img
 src="doxygen.png" alt="doxygen" align="middle"
 border="0"></a> 1.5.4 </small></address>
 </td>
 </tr>
 </table>
