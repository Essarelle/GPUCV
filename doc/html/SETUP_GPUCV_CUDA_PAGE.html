<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GpuCV: Cuda plugin setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="twiki_style.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="SETUP_GPUCV_CUDA_PAGE">Cuda plugin setup </a></h1><dl class="author"><dt><b>Author:</b></dt><dd>Yannick Allusse </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>GpuCV v1.0.0 rev 598</dd></dl>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_INTRO_SCT">
Introduction</a></h2>
<p>GpuCV-CUDA is a plugin for GpuCV that allow easy integration of CUDA library into GpuCV processing pipeline. It is base on NVIDIA GeForce 8 architecture and you must have a compatible card to use it.</p>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_SETUP_SCT1">
Setup</a></h2>
<p>The first step is to setup CUDA from NVIDIA on your workstation, visit <a href="http://developer.nvidia.com/object/cuda.html" target="blank">CUDA homepage</a> to download all corresponding packages: </p>
<ul>
<li>
Required: <ol>
<li>
Latest NVIDIA drivers supporting CUDA. </li>
<li>
Cuda toolkit. </li>
<li>
Cuda SDK. </li>
</ol>
</li>
<li>
Optional (support coming soon): <ol>
<li>
<a href=" http://developer.nvidia.com/object/npp_home.html" target="blank">NPP</a> </li>
<li>
<a href="http://www.culatools.com/" target="blank">CULATools</a> </li>
</ol>
</li>
</ul>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_SETUP_SCT1_1_WINDOWS">
Under MS Windows</a></h3>
<p>Install all binaries (drivers/CUDA toolkit/SDK) and reboot your system.</p>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_SETUP_SCT1_2_LINUX">
Under LINUX</a></h3>
<p>Download and install the appropriate Nvidia and CUDA drivers from the Nvidia website.</p>
<p>Now we need to defines some environnement variables for the user that want to use cuda, edit your ".bashrc" file and update the paths if required: </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#CUDA CUSTOM PATH DEFINITION</span>
<span class="preprocessor"></span>export CUDA_PATH=/usr/local/cuda
export CUDA_BIN_PATH=/usr/local/cuda/bin
export CUDA_LIB_PATH=/usr/local/cuda/lib
export CUDA_INC_PATH=/usr/local/cuda/include
export NVSDKCOMPUTE_ROOT=/home/$(YOUR USER HOME PATH)/NVIDIA_GPU_Computing_SDK
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CUDA_LIB_PATH:$NVSDKCOMPUTE_ROOT/lib
</pre></div><dl class="note"><dt><b>Note:</b></dt><dd>Additionnal packages required Some additionnal packages might be required such as libxmu6 and libxmu-dev: <div class="fragment"><pre class="fragment">apt-<span class="keyword">get</span> install libxmu6 libxmu-dev
</pre></div></dd></dl>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_CHECK_SCT">
Check that CUDA is working fine</a></h2>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_SETUP_SCT2_1__CHECK_WINDOWS">
Under MS Windows</a></h3>
<p>Open solution ".\%NVSDKCOMPUTE_ROOT%\common\Release.sln" and compile all samples. <br/>
Open solution ".\%NVSDKCOMPUTE_ROOT%\projects\Release.sln" and compile all samples. <br/>
<br/>
Run ".\%NVSDKCOMPUTE_ROOT%\bin\win32\Release\bandwidthTest.exe" and ".\%NVSDKCOMPUTE_ROOT%\bin\win32\Release\fluidsGL.exe" for a 32 bit Windows and Run ".\NVIDIA CUDA SDK\bin\win64\Release\bandwidthTest.exe" and ".\NVIDIA CUDA SDK\bin\win64\Release\fluidsGL.exe" for a 64 bit Windows.</p>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_SETUP_SCT2_2__CHECK_WINDOWS">
Under LINUX</a></h3>
<p>Go to NVIDIA SDK folder and compile: </p>
<div class="fragment"><pre class="fragment">cd $NVSDKCOMPUTE_ROOT
make
cd bin/linux/release
<span class="preprocessor">#test bandwith speed</span>
<span class="preprocessor"></span>./bandwidthTest
<span class="preprocessor">#test CUDA processing and OpenGL support</span>
<span class="preprocessor">./fluidsGL </span>
</pre></div><dl class="warning"><dt><b>Warning:</b></dt><dd>I got '/usr/include/bits/stdio2.h(182): error: identifier "__builtin_va_arg_pack" is undefined' message, see FAQ topic <a class="el" href="group__FAQ__GRP.html#FAQ_COMPILE_CUDA_GRP">CUDA compiling FAQs</a>.</dd></dl>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_ENABLING_SCT">
Enabling CUDA support</a></h2>
<p>GpuCV support CUDA using an optional library named GpuCV-Cuda that will be enabled automatically when generating the project files (if the CUDA toolkit and SDK are installed). To force activation use '--plug-cuda' or '--plug-cuda-off' option when running premake.: </p>
<div class="fragment"><pre class="fragment">premake4.exe [nothing <span class="keywordflow">for</span> <span class="keyword">auto</span>-detect|--plug-cuda|--plug-cuda--off] {other options...} [your target]
ex:
premake4.exe --plug-cuda gmake
</pre></div> <dl class="see"><dt><b>See also:</b></dt><dd>COMPILE_GPUCV_SCT__CUSTOMIZE</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>By calling the 'premake' script, all new .h/.c/.cpp/.cu will be added automatically to their respective projects except for the for Linux MakeFile, see following sections for details.</dd></dl>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_COMPILE_SCT_CUDA_RULES">
Cuda compiling rules</a></h2>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_COMPILE_SCT2_SUBSCT_VS_RULES">
With Visual Studio</a></h3>
<p>CUDA compiling rules are defined in "./gpucv/etc/vs2008_cuda.rules" and selected by default in the Visual Studio solutions. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Make sure to set the right environnement variables depending on your CUDA versions, 32/64 bits.</dd></dl>
<h3><a class="anchor" id="SETUP_GPUCV_CUDA_COMPILE_SCT2_SUBSCT_MAKE_RULES">
Under LINUX</a></h3>
<p>CUDA compiling rules are called automatically by the projects makefiles, global rules are defined in the following files: </p>
<ul>
<li>
"gpucv/etc/cuda_common_include.mk" </li>
<li>
"gpucv/etc/cuda_common_makefile.mk" </li>
<li>
"gpucv/etc/cuda_common_subdirs.mk" </li>
</ul>
<p>Then each cuda source sub folders have local MakeFiles. They are not automatically updated with the Premake script so you will have to edit them manually to add new .cu files. <br/>
Each path containing a .cu file must have two make files: </p>
<dl class="user"><dt><b>Example of Makefile</b></dt><dd><div class="fragment"><pre class="fragment"><span class="preprocessor">#compile only cuda files into all the given subdirs</span>
<span class="preprocessor"></span><span class="preprocessor">#list of sub folder to compile</span>
<span class="preprocessor"></span>ALL_SUB_DIRS =  oper_array
<span class="preprocessor">                #add sub folders here</span>
<span class="preprocessor"></span>
<span class="preprocessor">#update the path to gpucv root folder</span>
<span class="preprocessor"></span>ROOTDIR = ../../../
export SHARED_LIB_TMP = cxcoregcu
<span class="preprocessor">#include common CUDA makefiles to parse sub dirs</span>
<span class="preprocessor">include $(ROOTDIR)etc/cuda_common_subdirs.mk</span>
</pre></div></dd></dl>
<dl class="user"><dt><b>MakefileCUDA</b></dt><dd><div class="fragment"><pre class="fragment"><span class="preprocessor">###############################################################################</span>
<span class="preprocessor"></span><span class="preprocessor"># SOURCE VARS</span>
<span class="preprocessor"></span><span class="preprocessor">#list of local .cu files</span>
<span class="preprocessor"></span>CUFILES         =       cxcoregcu_array.filter.cu\
                        cxcoregcu_array_transform.cu

                        
<span class="preprocessor">#list of local CPP files(OPTIONAL)</span>
<span class="preprocessor"></span>CCFILES         :=      cxcoregcu.cpp\
                        cvgcudalocalsum.cpp

<span class="preprocessor">#target library name</span>
<span class="preprocessor"></span>SHARED_LIB_TEMP = cxcoregcu
NO_LINKING=2
SRCDIR = ./
ROOTDIR = ../../../
<span class="preprocessor">#include common CUDA makefiles</span>
<span class="preprocessor"></span>include $(ROOTDIR)etc/cuda_common_include.mk
include $(ROOTDIR)etc/cuda_common_makefile.mk
<span class="preprocessor">##############################################################################</span>
</pre></div></dd></dl>
<h2><a class="anchor" id="SETUP_GPUCV_CUDA_USE_SCT">
Use GpuCV-CUDA plug-in in your project</a></h2>
<dl class="user"><dt><b>Using the switch</b></dt><dd>When using the switch mechanism, you do not need to initialize CUDA plugins or include any files in your application.</dd></dl>
<dl class="user"><dt><b>Using the plugins manually</b></dt><dd>In order to manuallt use GpuCVCuda plugin in your application you need to perform the following steps: <ul>
<li>
include header: <b>"&lt;GpuCVCuda/include.h&gt;"</b> </li>
<li>
include main GpuCVCuda lib: <b>GpuCVCuda[32|64][D].lib</b> </li>
<li>
include operators headers and libs: <b>cvgcu[32|64][D].lib</b>, <b>cxcoregcu[32|64][D].lib</b>,... </li>
<li>
Replace <b><a class="el" href="group__CVG__MISC__GRP.html#gae9ff9ef6c8a7ac1824ebafb500668a9a" title="Initialize GpuCV library and framework, test extensions, and create or use a GL context...">cvgInit()</a> by cvgcuInit()</b> </li>
<li>
Call GpuCVCuda operators using <b>cvgCuda*</b> convention. </li>
</ul>
</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Please refer to tutorial <a class="el" href="TUTO_INTEGRATION_PRJ.html">Using GpuCV into your project</a> for more details. </dd></dl>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1">
<table border="0" width="100%">
<tr>
<td>
Retrieve latest informations, releases and documentation on <a href="https://picoforge.int-evry.fr/cgi-bin/twiki/view/Gpucv/Web/WebHome">GpuCV website</a>.
</td>
<td width ="50">
</td>
<td>
<address style="text-align: right;"><small>Generated
on Wed Oct 22 20:37:13 2008 for <a href="https://picoforge.int-evry.fr/cgi-bin/twiki/view/Gpucv/Web/WebHome">GpuCV</a> by&nbsp;
<a href="http://www.doxygen.org/index.html"><img
 src="doxygen.png" alt="doxygen" align="middle"
 border="0"></a> 1.5.4 </small></address>
 </td>
 </tr>
 </table>
